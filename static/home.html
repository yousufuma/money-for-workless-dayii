<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>chatroom</title>
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<!-- <link rel="stylesheet" href="css/style2.css"> -->
	<style>
		body {
			display: flex;
		}

		input {
			border: 0px;
			background: none;
		}

		input:blank {
			border: 0px;
			background: none;
		}

		textarea {
			border: 10px;
			background: none;
		}
	</style>
</head>

<body>
	<!-- <div class="center">
		<div class="div1">
			<div class="demo">
				<span id="nowTime"></span>
				<span id="nowTime2"></span>
			</div>
		</div>
		<div class="div2">
			<img src="img/tp.jpeg" id="avator"><br>
			<input type="file" name="" id="fileInp" value="" hidden />
			<ul>
				<li style="color: #FFF;">name：<input type="text" name="" id="" value="" /></li>
				<li style="color: #FFF;">Donation number：<input type="text" name="" id="" value="" /></li>
			</ul>
		</div>
		<div class="div3">
			<p class="font">Personal statement</p>
			<form action="#" method="post">
				<textarea name="description" id="textarea"></textarea>
			</form>
		</div>
		<div class="div4">
			<p class="font2">Scanning code and donation</p>
			<img src="img/二维码.jpeg">
		</div>
	</div> -->

	<div class="content" id="content">
		<div class="top_cen">
			<div class="two_img">
				
				<img src="./img/one.png" alt="">
			
			<div class="top_cen_right">

				<!-- Registered function -->
				<div class="div2">
					<img :src="postform.ataver" @click= "gouploadFile" id="avator"><br>
					<input type="file" name="" id="fileInp" value="" hidden  accept="image/*" @change="setAvatar()" />
					<p class=font3>THAT IS YOU(UPLOAD A PIC)</p>
					<!-- <ul>
						<li style="color: #FFF;">NAME：{{postform.name}}<input type="text" name="" v-model="postform.name" id="" value="" /></li>
						
						<li style="color: #FFF;">MOOD TODAY：{{postform.modetoday}}<input type="text" name="" v-model="postform.modetoday"  id="" value="" /></li>
					</ul> -->
				</div>

				<!-- question part -->
				<div class="r_btm">
					<div class="div3">
						<button class="font"  @click="saveData">GO!</button> 
						<p class="font4">
						ASK</p>
						<form action="#" method="pst">
							<textarea name="description" id="textarea" v-model="postform.lstatement" class=font></textarea>
						</form>
					</div>

					<!-- anwser part -->
					<div class="div4">
						<button class="font2"  @click="saveData">GO!</button> 
						<p class="font2">ANWSER</p>
						<form action="#" method="pst">
							<textarea name="description" id="textarea" v-model="postform.pstatement" class=font></textarea>
						</form>
					</div>
				</div>
			</div>
		</div>
    

		<div class="btm_img">
			<img src="./img/three.png" alt="">
			<img src="./img/four.png" alt="">
		</div>

		
    	 <!-- Chat list -->
		 <div class="chatDiv" style="clear:both;">
			<ul id="chatlist">
			   <li v-for="u in chatData" class="div5" >
					<img :src="u.ataver"  />  
					<!--name，moodtoday，ask，anwser-->
					<span>{{u.name}} </span>
					&nbsp;
					<span>{{u.modetoday}}</span>
					&nbsp;
					<span>{{u.lstatement}}</span>
					&nbsp;
					<span>{{u.pstatement}}</span>
					
			   </li>
			</ul>
		</div>
	</div>

	<div id="vignette"></div>
	<script src="js/new_file.js"></script>
	<script src="js/script.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
	<script>
	var app = new Vue({
		el: '#content',
		data: {
			postform:{
				name:'',
				modetoday:'',
				pstatement:'',
				lstatement:'',
				ataver:'img/tp.jpeg',
			},
			chatData:[],
		},
		mounted(){
			this.initData();
		},
		methods:{
			initData(){
				let that = this;
				HTTP.post('user/getList', {}).then(json => {
					if (json.code == 0) {
						that.chatData = json.data;
						console.log(json);
					}else {
						console.log(json)
						alert('上传发生错误')
					}
				})
			},
			saveData(){
				let that = this;
				HTTP.post('user/savedata', this.postform).then(json => {
					if (json.code == 0) {
						alert(json.msg);
						that.initData();
						console.log(json);
					}else {
						console.log(json)
						alert('上传发生错误')
					}
				})
			},
			gouploadFile(){
				document.querySelector('#fileInp').click()
			},
			setAvatar(){
				let fileinput = document.querySelector('#fileInp');
				let convertSize = 100000,
				imgFile = fileinput.files[0];
				let that = this;
				let upload = function (file) {
					let formdata = new FormData();
					formdata.append('avatar', file)
					HTTP.post('user/avatar', { FormData: formdata }).then(json => {
						if (json.code == 0) {
							that.postform.ataver = json.avatar;
							console.log(json);
						}else {
							console.log(json)
							alert('上传发生错误')
						}
					})
				}
				upload(imgFile)
			}
		}
	})
	
	</script>
</body>

</html>